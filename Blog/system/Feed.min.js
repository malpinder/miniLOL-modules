(function(){return Class.create({initialize:function(b,a){this.root=b;this.path=a.path||"/feed.xml";this.type=a.type;this.version=a.version;if(!this.type||!this.version){this.type=this.type||"rss";this.version="2.0"}this.max=a.max;this.title=a.title||miniLOL.config.core.siteTitle;this.description=a.description||"#{title} feed.".interpolate({title:this.title});this.language=a.language||"en-us";$$("head")[0].insert(new Element("link",{rel:"alternate",type:"application/#{type}+xml".interpolate({type:this.type}),
href:miniLOL.path+this.path,title:this.title}))},update:function(b){new Ajax.Request(this.root+"/main.php",{parameters:{feed:this.path,content:this.build(b)},onFailure:function(a){miniLOL.content.set("Failed to send the feed (#{status} - #{statusText}).".interpolate(a))}})},build:function(b){var a=this.callbacks["#{type}-#{version}".interpolate({type:this.type,version:this.version})];if(!a)return false;return a.call(this,b)},callbacks:{"rss-2.0":function(b){var a="";b=$A(b.getElementsByTagName("post"));
var d=this.max||b.length;a+="<?xml version='1.0' encoding='utf-8'?>\n<rss version='2.0'>\n    <channel>\n        <title><![CDATA[#{title}]]\></title>\n        <description><![CDATA[#{description}]]\></description>\n        <link><![CDATA[#{link}]]\></link>\n        <language><![CDATA[#{language}]]\></language>\n        <pubDate><![CDATA[#{date}]]\></pubDate>\n        <lastBuildDate><![CDATA[#{date}]]\></lastBuildDate>\n        <generator><![CDATA[miniLOL-Blog-#{version}]]\></generator>\n        <webMaster><![CDATA[#{author}]]\></webMaster>\n".interpolate({title:this.title,
description:this.description,link:"#{path}/#module=blog".interpolate(miniLOL),language:this.language,date:(new Date).toUTCString(),version:miniLOL.module.get("Blog").version,author:miniLOL.config.Blog.author.post});d=b.length-d;if(d<=0)d=b.length;b.each(function(c){var e;e=miniLOL.config.Blog.feed.description=="full"?c.firstChild.nodeValue:c.firstChild.nodeValue.match(/^(.*?)(<br|\n)/)[1];a+="<item>\n    <title><![CDATA[#{title}]]\></title>\n    <link><![CDATA[#{link}]]\></link>\n    <guid><![CDATA[#{link}]]\></guid>\n    <description><![CDATA[#{description}]]\></description>\n    <pubDate><![CDATA[#{date}]]\></pubDate>\n</item>\n".interpolate({title:c.getAttribute("title"),
link:"#{path}/#module=blog&id=#{id}".interpolate({path:miniLOL.path,id:c.getAttribute("id")}),description:e,date:(new Date(c.getAttribute("date"))).toUTCString()})});a+="</channel>\n</rss>";return a}}})})();
