(function(){return Class.create({initialize:function(a){this.root=a;this.load()},load:function(){miniLOL.theme.style.exists("Blog/style")||miniLOL.theme.style.load("/resources/style",this.root);var a=miniLOL.theme.template.load("Blog/template")||miniLOL.theme.template.load("/resources/template",this.root);if(!a){miniLOL.error()||miniLOL.error("Couldn't find the blog's template.",miniLOL.theme.content());return false}this.template={};this.editors={};this.template.blog=a.getElementsByTagName("blog")[0].firstChild.nodeValue;
var b=a.getElementsByTagName("posts")[0],d=b.getElementsByTagName("pager")[0],c=d.getElementsByTagName("numbers")[0];this.template.posts={};this.template.posts.overall=b.firstChild.nodeValue;this.template.posts.pager_overall=d.firstChild.nodeValue;this.template.posts.pager_previous=b.getElementsByTagName("previous")[0].firstChild.nodeValue;this.template.posts.pager_numbers=c.firstChild.nodeValue;this.template.posts.pager_numbers_length=parseInt(c.getAttribute("length"));this.template.posts.pager_numbers_first=
c.getElementsByTagName("first")[0].firstChild.nodeValue;this.template.posts.pager_numbers_inner=c.getElementsByTagName("inner")[0].firstChild.nodeValue;this.template.posts.pager_numbers_current=c.getElementsByTagName("current")[0].firstChild.nodeValue;this.template.posts.pager_numbers_last=c.getElementsByTagName("last")[0].firstChild.nodeValue;this.template.posts.pager_next=d.getElementsByTagName("next")[0].firstChild.nodeValue;b=a.getElementsByTagName("post")[0];d=b.getElementsByTagName("pager")[0];
c=d.getElementsByTagName("numbers")[0];this.template.post={};this.template.post.overall=b.firstChild.nodeValue;this.template.post.pager_overall=d.firstChild.nodeValue;this.template.post.pager_previous=b.getElementsByTagName("previous")[0].firstChild.nodeValue;this.template.post.pager_numbers=c.firstChild.nodeValue;this.template.post.pager_numbers_length=parseInt(c.getAttribute("length"));this.template.post.pager_numbers_first=c.getElementsByTagName("first")[0].firstChild.nodeValue;this.template.post.pager_numbers_inner=
c.getElementsByTagName("inner")[0].firstChild.nodeValue;this.template.post.pager_numbers_current=c.getElementsByTagName("current")[0].firstChild.nodeValue;this.template.post.pager_numbers_last=c.getElementsByTagName("last")[0].firstChild.nodeValue;this.template.post.pager_next=d.getElementsByTagName("next")[0].firstChild.nodeValue;a=a.getElementsByTagName("manage")[0];this.template.manage={};this.template.manage.admin=a.getElementsByTagName("admin")[0].firstChild.nodeValue;this.template.manage.post=
a.getElementsByTagName("post")[0].firstChild.nodeValue;this.template.manage.edit=a.getElementsByTagName("edit")[0].firstChild.nodeValue;a=miniLOL.theme.template.load("Blog/editors")||miniLOL.theme.template.load("/resources/editors",this.root);if(!a){miniLOL.error()||miniLOL.error("Couldn't find the blog's template.");return false}$A(a.getElementsByTagName("editor")).each(function(e){this.editors[e.getAttribute("type")]=e.firstChild.nodeValue},this)},reload:function(){this.load()},apply:function(a,
b){return this.callbacks[a].call(this,b)},callbacks:{post:function(a){var b="";if(a.number)b=this.apply("pager_overall",{type:"number",position:a.number,total:a.total});b=this.template.post.overall.interpolate({id:a.post.getAttribute("id"),content:a.post.firstChild.nodeValue,title:a.post.getAttribute("title"),date:a.post.getAttribute("date"),author:a.post.getAttribute("author"),link:"#module=Blog&id=#{id}".interpolate({id:a.post.getAttribute("id")}),pager:b,admin:miniLOL.module.execute("Security",
{connected:true,cached:true})?this.apply("admin",{id:a.post.getAttribute("id")}):""});return Object.isUndefined(a.number)?b:this.template.blog.interpolate({content:b})},posts:function(a){var b="";a.posts.each(function(d){b+=this.apply("post",{post:d})},this);return this.template.blog.interpolate({content:this.template.posts.overall.interpolate({posts:b,pager:this.apply("pager_overall",{type:"page",position:a.page,total:a.total})})})},pager_overall:function(a){var b;if(a.type=="number")b=this.template.post.pager_overall;
else if(a.type=="page")b=this.template.posts.pager_overall;return b.interpolate({previous:this.apply("pager_previous",a),numbers:this.apply("pager_numbers",a),next:this.apply("pager_next",a)})},pager_previous:function(a){var b;if(a.type=="number")b=this.template.post.pager_previous;else if(a.type=="page")b=this.template.posts.pager_previous;var d=a.position<=1?a.position:a.position-1;return b.interpolate({number:d,link:"#module=Blog&#{type}=#{value}".interpolate({type:a.type,value:d})})},pager_numbers:function(a){var b;
if(a.type=="number")b=this.template.post;else if(a.type=="page")b=this.template.posts;var d=Math.floor(b.pager_numbers_length/2)+a.position,c=d-b.pager_numbers_length+1;if(c<1){c=1;d+=b.pager_numbers_length-d}if(d>a.total){c-=d-a.total;if(c<1)c=1;d=a.total}var e=b[c==a.position?"pager_numbers_current":"pager_numbers_first"].interpolate({number:c,link:"#module=Blog&#{type}=#{value}".interpolate({type:a.type,value:c})});if(a.total>1){for(c=c+1;c<d;c++)e+=b[c==a.position?"pager_numbers_current":"pager_numbers_inner"].interpolate({number:c,
link:"#module=Blog&#{type}=#{value}".interpolate({type:a.type,value:c})});e+=b[d==a.position?"pager_numbers_current":"pager_numbers_last"].interpolate({number:d,link:"#module=Blog&#{type}=#{value}".interpolate({type:a.type,value:d})})}return b.pager_numbers.interpolate({content:e})},pager_next:function(a){var b;if(a.type=="number")b=this.template.post.pager_next;else if(a.type=="page")b=this.template.posts.pager_next;var d=a.position>=a.total?a.position:parseInt(a.position)+1;return b.interpolate({number:d,
link:"#module=Blog&#{type}=#{value}".interpolate({type:a.type,value:d})})},new_post:function(a){return this.template.blog.interpolate({content:this.template.manage.post.interpolate({author:a.author,editor:this.editors[miniLOL.config.Blog.editorType||"simple"]})})},edit_post:function(a){return this.template.blog.interpolate({content:this.template.manage.edit.interpolate({title:a.title,author:a.author,date:a.date,id:a.id,editor:this.editors[miniLOL.config.Blog.editorType||"simple"]})})},admin:function(a){return this.template.manage.admin.interpolate({id:a.id})}}})})();
