(function(){return Class.create({initialize:function(a,c){this.root=a;var e=this;this.resource=new miniLOL.Resource("Language.resource",{load:function(d){e.languages=this.data;new Ajax.Request(d,{method:"get",asynchronous:false,onSuccess:function(b){Document.check(b.responseXML,d)||$A(b.responseXML.getElementsByTagName("language")).each(function(f){e.languages.push({code:f.getAttribute("code"),name:f.getAttribute("name")})})},onFailure:function(b){miniLOL.error("Error while loading config.xml (#{error})".interpolate({error:b.status}))}})},
clear:function(){this.data=[]}});this.resource.load(this.root+c);miniLOL.resource.get("miniLOL.menus").flush(["resources/menus.xml"]);miniLOL.resource.get("miniLOL.pages").flush(["resources/pages.xml"])},set:function(a,c,e){Object.isString(a)||(a=a.name||a.code);if(!a)throw Error("No correct language was passed.");var d=this.languages.find(function(b){if(b.name==a||b.code==a)return true});if(!d)throw Error("`#{language}` is not in the languages list.".interpolate({language:a}));this.old=this.current;
this.current=d;if(this.old!=this.current){e&&miniLOL.module.get("Language").storage.set("language",this.current);Event.fire(document,":module.Language.change",this.current);this.apply(c)}},apply:function(a){if(this.old!=this.current){miniLOL.resource.get("miniLOL.config").flush([this.root+"/resources/languages/#{code}/config.xml".interpolate(this.old)]);miniLOL.resource.get("miniLOL.menus").flush([this.root+"/resources/languages/#{code}/menus.xml".interpolate(this.old)]);miniLOL.resource.get("miniLOL.pages").flush([this.root+
"/resources/languages/#{code}/pages.xml".interpolate(this.old)]);if(!miniLOL.resource.get("miniLOL.config").load(this.root+"/resources/languages/#{code}/config.xml".interpolate(this.current)))return false;if(!miniLOL.resource.get("miniLOL.menus").load(this.root+"/resources/languages/#{code}/menus.xml".interpolate(this.current)))return false;if(!miniLOL.resource.get("miniLOL.pages").load(this.root+"/resources/languages/#{code}/pages.xml".interpolate(this.current)))return false}if(a){miniLOL.menu.change(miniLOL.menu.current,
true);return miniLOL.go(location.href)}},page:function(a,c){miniLOL.go("#page=../#{root}/resources/languages/#{code}/data/#{page}".interpolate({root:this.root,code:c||this.current.code,page:a}))},toArray:function(){return this.languages}})})();
