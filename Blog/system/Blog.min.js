(function(){return Class.create({initialize:function(a,e,c){this.root=a;var b=this;this.resource=new miniLOL.Resource("Blog",{load:function(d){var g=this.data;new Ajax.Request(d+"?failCache="+Math.random(),{method:"get",asynchronous:false,requestHeaders:{"Cache-Control":"must-revalidate",Pragma:"no-cache"},onSuccess:function(f){if(!miniLOL.utils.XML.check(f.responseXML,d))g.data=miniLOL.utils.XML.fix(f.responseXML)},onFailure:function(f){miniLOL.error("Error while loading Blog's data.xml (#{error})".interpolate({error:f.status}))}});
if(!g.data)return false;b.data=this.data.data;b.cache=this.data.cache},clear:function(){this.data={data:null,cache:{}}}});this.resource.load(this.root+e);miniLOL.resource.get("miniLOL.config").load(this.root+c);this.Template=miniLOL.utils.execute(this.root+"/system/Template.min.js");this.template=new this.Template(this.root);this.Feed=miniLOL.utils.execute(this.root+"/system/Feed.min.js");this.feed=new this.Feed(this.root,{path:miniLOL.config.Blog.feed.path,type:miniLOL.config.Blog.feed.type,version:miniLOL.config.Blog.feed.version,
max:miniLOL.config.Blog.feed.max,title:miniLOL.config.Blog.feed.title,description:miniLOL.config.Blog.feed.description,language:miniLOL.config.Blog.feed.language})},post:function(a,e){var c,b;if(Object.isString(a)){c=e;b=a}else{c=a;b=""}miniLOL.module.execute("Logger",["log",100,"Blog","post",b,c]);if(!b)if(!miniLOL.module.execute("Security",{connected:true})){miniLOL.content.set("You're doing it wrong.");return false}new Ajax.Request(this.root+"/main.php?post&"+b,{method:"post",tokenized:true,parameters:c,
onSuccess:function(d){miniLOL.content.set(d.responseText);miniLOL.module.execute("Blog",{rehash:true});miniLOL.module.execute("Blog",{feed:true,build:true})},onFailure:function(){miniLOL.error("Something went deeply wrong.",true)}})},edit:function(a,e){var c,b;if(Object.isString(a)){c=e;b=a}else{c=a;b=""}miniLOL.module.execute("Logger",["log",100,"Blog","post",b,c]);if(!miniLOL.module.execute("Security",{connected:true})){miniLOL.content.set("You're doing it wrong.");return false}new Ajax.Request(this.root+
"/main.php?edit&"+b,{method:"post",tokenized:true,parameters:c,onSuccess:function(d){miniLOL.content.set(d.responseText);miniLOL.module.execute("Blog",{rehash:true});miniLOL.module.execute("Blog",{feed:true,build:true})},onFailure:function(){miniLOL.error("Something went deeply wrong.",true)}})},remove:function(a,e){var c,b;if(Object.isString(a)){c=e;b=a}else{c=a;b=""}miniLOL.module.execute("Logger",["log",100,"Blog","remove",b,c]);if(!miniLOL.module.execute("Security",{connected:true})){miniLOL.content.set("You're doing it wrong.");
return false}new Ajax.Request(this.root+"/main.php?remove&"+b,{method:"post",tokenized:true,parameters:c,onSuccess:function(d){miniLOL.content.set(d.responseText);miniLOL.module.execute("Blog",{rehash:true});miniLOL.module.execute("Blog",{feed:true,build:true})},onFailure:function(){miniLOL.error("Something went deeply wrong.",true)}})},rehash:function(){this.resource.reload()},getPost:function(a){return this.data.getElementById(a)},getPostInfo:function(a){a=Object.isString(a)?this.getPost(a):a;return{date:a.getAttribute("date"),
id:a.getAttribute("id"),title:a.getAttribute("title"),author:a.getAttribute("author")}},getPosts:function(){return $A(this.data.getElementsByTagName("post"))}})})();
