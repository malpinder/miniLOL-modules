miniLOL.module.create("Syntax Highlighter",{version:"0.3",type:"passive",aliases:["SyntaxHighlighter"],initialize:function(){Object.isUndefined(window.XRegExp)&&miniLOL.utils.require(this.root+"/system/xregexp.min.js");miniLOL.utils.require(this.root+"/system/shCore.min.js");miniLOL.resource.get("miniLOL.functions").load(this.root+"/resources/functions.xml");miniLOL.resource.get("miniLOL.config").load(this.root+"/resources/config.xml");SyntaxHighlighter.config.tagName=miniLOL.config["Syntax Highlighter"].tagName;
SyntaxHighlighter.config.toolbar=false;for(var a in miniLOL.config["Syntax Highlighter"])SyntaxHighlighter.defaults[a]=miniLOL.config["Syntax Highlighter"][a][0]=="["&&confs[a][confs[a].length-1]=="]"?eval(miniLOL.config["Syntax Highlighter"][a].replace(/[^\d\[\],]/g,"")):miniLOL.config["Syntax Highlighter"][a];this.loaded={};this.languages={};this.aliases={};new Ajax.Request(this.root+"/resources/languages.xml",{method:"get",asynchronous:false,onSuccess:function(d){$A(d.responseXML.getElementsByTagName("language")).each(function(b){var c=
b.getAttribute("file");this.languages[c]=b.getAttribute("aliases");this.languages[c].split(/ /).each(function(e){this.aliases[e]=c},this)},this)}.bind(this),onFailure:function(){miniLOL.content.set("Something went wrong while loading languages.xml.")}});miniLOL.theme.style.load("shCore",this.root+"/resources/styles");if(miniLOL.config["Syntax Highlighter"].style){miniLOL.theme.style.unload("Syntax Highlighter/style");miniLOL.theme.style.load("shTheme"+miniLOL.config["Syntax Highlighter"].style,this.root+
"/resources/styles")}Event.observe(document,":go",function(){miniLOL.module.execute("Syntax Highlighter")})},loadFile:function(a){if(a&&!this.loaded[a])if(miniLOL.utils.include(this.root+"/resources/languages/shBrush"+a+".min.js")){this.loaded[a]=true;SyntaxHighlighter.vars.discoveredBrushes={};for(var d in SyntaxHighlighter.brushes){var b=SyntaxHighlighter.brushes[d].aliases;b&&b.each(function(c){SyntaxHighlighter.vars.discoveredBrushes[c]=d})}}else $$(SyntaxHighlighter.config.tagName).each(function(c){var e=
((c.getAttribute("class")||"").match(/brush:\s*(.*?)(;|$)/)||[])[1];if(e&&this.aliases[e]==a){c.setAttribute("class",c.getAttribute("class").replace(/brush:.*(;|$)/,""));c.update("Could not load the brush.")}},this)},loadTagFiles:function(){$$(SyntaxHighlighter.config.tagName).each(function(a){(a=((a.getAttribute("class")||"").match(/brush:\s*(.*?)(;|$)/)||[])[1])&&this.loadFile(this.aliases[a])},this)},execute:function(a){if(!$$(".syntaxhighlighter").length){a=a||{};var d=Object.extend({},SyntaxHighlighter.defaults);
for(var b in a)SyntaxHighlighter.defaults[b]=a[b][0]=="["&&a[b][a[b].length-1]=="]"?eval(a[b].replace(/[^\d\[\],]/g,"")):a[b];if(a.lang){SyntaxHighlighter.defaults.brush=a.lang;this.loadFile(this.aliases[a.lang])}this.loadTagFiles();SyntaxHighlighter.highlight();SyntaxHighlighter.defaults=d}}});
