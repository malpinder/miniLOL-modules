miniLOL.module.create("Gallery",{version:"0.1",initialize:function(){miniLOL.resource.get("miniLOL.config").load(this.root+"/resources/config.xml");Event.observe(document,":go",this.execute)},execute:function(){this.periodical&&(this.periodical.stop(),delete this.periodical,$("image")&&$("image").update(""),$("thumbnails")&&$("thumbnails").update(""));this.dom=Element.xpath(miniLOL.page.current,"./images")[0];if(!this.dom||!$("image"))return!1;this.images=$A(this.dom.getElementsByTagName("*"));if(this.images.empty())return!1;
this.current=0;this.dom.getAttribute("thumbnails")!="false"&&this.images.each(function(d,b){var c=new Element("div",{"class":"thumbnail",id:"thumbnail_"+b}),a=new Element("a",{href:"javascript: void(0)"});a.update("<img src='"+d.getAttribute("thumbnail")+"'/>");a.observe("click",function(){this.periodical.stop();var a=this.current==0?this.images.length-1:this.current-1;$("thumbnail_"+a)&&$("thumbnail_"+a).removeClassName("current");this.current=b;this.periodical.initialize(this.periodical.callback,
this.periodical.frequency);this.periodical.execute()}.bind(this));c.insert(a);$("thumbnails").insert(c)}.bind(this));this.periodical=new PeriodicalExecuter(function(){$("image").fade({duration:0.7,afterFinish:function(){$("image").update("<img src='"+this.images[this.current].getAttribute("src")+"'/>");Event.fire(document,":image.add");this.dom.getAttribute("thumbnails")!="false"&&(this.current==0?$("thumbnail_"+(this.images.length-1)).removeClassName("current"):$("thumbnail_"+(this.current-1)).removeClassName("current"),
$("thumbnail_"+this.current).addClassName("current"));$("image").appear({duration:0.7,afterFinish:function(){Event.fire(document,":image.added");this.current++;if(this.current>=this.images.length)this.current=0}.bind(this)})}.bind(this)})}.bind(this),parseInt(miniLOL.config.Gallery.changeEvery));this.periodical.execute()}});
