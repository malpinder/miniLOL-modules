(function(){return Class.create({initialize:function(a,c){this.root=a;var d=this;this.resource=new miniLOL.Resource("Menu Shell",{load:function(e){d._commands=this._data;new Ajax.Request(e,{method:"get",asynchronous:false,onSuccess:function(b){if(!miniLOL.utils.checkXML(b.responseXML,e)){b=b.responseXML.documentElement.getElementsByTagName("command");for(var f=0;f<b.length;f++){var g=b[f].getAttribute("name");try{d._commands[g]=new Function(b[f].firstChild.nodeValue);d._commands[g].length=b[f].getAttribute("length")}catch(h){miniLOL.error("Error while creating `#{name}` wrapper from #{path}:<br/><br/>#{error}".interpolate({name:g,
path:e,error:h.toString()}));return}}}},onFailure:function(b){miniLOL.error("Error while loading #{path} (#{error})".interpolate({path:e,error:b.status}))}});if(miniLOL.error())return false;return true}});miniLOL.resource.load(this.resource,this.root+c);this._variables={PWD:"/"};this.Template=miniLOL.utils.require(this.root+"/system/Template.js");this.template=new this.Template("template",this.root+"/resources")},execute:function(a){var c=this.parse(a);if(!c)return false;a=c.command;c=c.parameters;
if(!this._commands[a]){var d=this.treeUrl(a);if(d)miniLOL.go(d);else return false}if(c.length<this._commands[a].length)return"#{command}: needs #{length} parameters.".interpolate({command:a,length:this._commands[a].length});return this._commands[a].apply(this,c)},parse:function(a){a=a.match(/^(\w+)( (.*))?$/);if(!a)return null;var c={command:a[1],parameters:[]},d=a[3];if(!d)return c;var e=false;a="";for(var b=0;b<d.length;b++)if(d[b]=="\\")a+=d[++b];else if(d[b]=='"')e=e?false:true;else if(d[b]==
" "&&!e){c.parameters.push(a);a=""}else a+=d[b];c.parameters.push(a);return c},context:function(){return{menu:this._menu,commands:this._commands,variables:this._variables}},set:function(a,c){if(!a)throw new Error("No name given.");if(c===null)delete this._variables[a];else this._variables[a]=c},menu:function(a){if(!a)throw new Error("The menu can't be null.");this._menu=a},tree:function(){}})})();
