miniLOL.module.create("Security",{version:"0.2.4",type:"passive",aliases:["security"],initialize:function(){miniLOL.utils.require(this.root+"/system/extensions.min.js");miniLOL.theme.style.exists("Security/style")||miniLOL.theme.style.load("style",this.root+"/resources");new Ajax.Request(this.root+"/main.php?build",{method:"get",asynchronous:false,onFailure:function(){miniLOL.content.set("Failed to build the configuration tree.")}});this.execute({connected:true})},execute:function(a){if(a)if(a.login)if(a["do"]){miniLOL.module.execute("Logger",
["log",100,"Security","login",a.password||""]);if(!a.password){miniLOL.error("The password is missing.",miniLOL.theme.content(),true);return false}new Ajax.Request(this.root+"/main.php?login&password=#{0}".interpolate([encodeURIComponent(a.password)]),{method:"get",tokenized:true,onSuccess:function(b){miniLOL.content.set(b.responseText);miniLOL.module.execute("Security",{connected:true})&&Event.fire(document,":security","login")},onFailure:function(){miniLOL.error("Something went deeply wrong :(",
miniLOL.theme.content())}})}else new Ajax.Request(this.root+"/resources/template.php?login",{method:"get",onSuccess:function(b){miniLOL.content.set(b.responseText)},onFailure:function(){miniLOL.error("Something went deeply wrong :(",miniLOL.theme.content())}});else if(a.logout){miniLOL.module.execute("Logger",["log",30,"Security","logout"]);new Ajax.Request(this.root+"/main.php?logout",{method:"get",tokenized:true,onSuccess:function(b){miniLOL.content.set(b.responseText);miniLOL.modules.security.connected=
false;Event.fire(document,":security","logout")},onFailure:function(){miniLOL.error("Something went deeply wrong :(",miniLOL.theme.content())}})}else if(a.change)if(a["do"]){miniLOL.module.execute("Logger",["log",100,"Security","change",a.password||"",a.type||""]);if(!a.password||!a.type){miniLOL.error("The password or the type are missing.",miniLOL.theme.content());return false}new Ajax.Request(this.root+"/main.php?change&password=#{0}&type=#{1}".interpolate([encodeURIComponent(a.password),encodeURIComponent(a.type)]),
{method:"get",tokenized:true,onSuccess:function(b){miniLOL.content.set(b.responseText)},onFailure:function(){miniLOL.error("Something went deeply wrong :(",miniLOL.theme.content())}})}else new Ajax.Request(this.root+"/resources/template.php?change",{method:"get",onSuccess:function(b){miniLOL.content.set(b.responseText)},onFailure:function(){miniLOL.error("Something went deeply wrong :(",miniLOL.theme.content())}});else if(a.connected){if(a.cached)return this.connected;var c="false";miniLOL.module.execute("Logger",
["log",30,"Security","connected"]);new Ajax.Request(this.root+"/main.php?connected",{method:"get",asynchronous:false,onSuccess:function(b){c=b.responseText}});return this.connected=c=="true"}else if(a.token){new Ajax.Request(this.root+"/main.php?token",{method:"get",asynchronous:false,onSuccess:function(b){c=b.responseText}});return c}else if(a.get){c="";miniLOL.module.execute("Logger",["log",30,"Security","get",a.get]);new Ajax.Request(this.root+"/main.php?get="+a.get,{method:"get",asynchronous:false,
onSuccess:function(b){c=b.responseText}});return c}}});
