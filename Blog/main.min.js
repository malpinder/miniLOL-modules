miniLOL.module.create("Blog",{version:"0.3",type:"active",aliases:["blog"],initialize:function(){this.Blog=miniLOL.utils.execute(this.root+"/system/Blog.min.js");this.blog=new this.Blog(this.root,"/resources/data.xml","/resources/config.xml");Event.observe(document,":refresh",function(){miniLOL.module.execute("Blog",{rehash:true})})},execute:function(a){if(a.post||a.edit||a.remove){if(!a.id&&!(a.post&&!a.comment)){miniLOL.error("No id or content was passed.",true);return false}if(a.comment){if(a.post)if(a["do"]){a.title=
a.title||"Re: "+this.topic(a.id).title;a.date=(new Date).toString();a.author=a.author||miniLOL.config.Blog.author.comment;this.blog.post("comment",{title:a.title,date:a.date,author:a.author,content:a.content})}else miniLOL.content.set(this.blog.template.apply("new_comment",{id:a.id}))}else if(a.post)if(a["do"]){a.title=a.title||"";a.date=a.date||(new Date).toString();a.author=a.author||miniLOL.config.Blog.author.post;a.content=a.content||"";miniLOL.content.set("Posting...");this.blog.post({title:a.title,
date:a.date,author:a.author,content:a.content})}else miniLOL.content.set(this.blog.template.apply("new_post",{author:miniLOL.config.Blog.author.post}));else if(a.edit)if(a.id)if(a["do"]){a.title=a.title||"";a.date=a.date||(new Date).toString();a.author=a.author||miniLOL.config.Blog.author.post;a.content=a.content||"";this.blog.edit({id:a.id,title:a.title,date:a.date,author:a.author,content:a.content})}else{var b=this.blog.getPost(a.id);if(b==null){miniLOL.error("The post doesn't exist.",miniLOL.theme.content(),
true);return false}miniLOL.content.set(this.blog.template.apply("edit_post",{title:b.getAttribute("title"),author:b.getAttribute("author"),date:b.getAttribute("date"),id:a.id}))}else{miniLOL.error("No id was passed, what post should I edit?",true);return false}else if(a.remove){if(!a.id){miniLOL.error("No id was passed, what post should I remove?",true);return false}if(a["do"])this.blog.remove({id:a.id});else{miniLOL.content.set("You're doing it wrong.");return false}}}else if(a.rehash)this.blog.rehash();
else if(a.feed)a.build&&this.blog.feed.update(this.blog.data);else if(a.dashboard)miniLOL.content.set(this.blog.template.apply("dashboard"));else{a.page=a.page||1;if(a.id)if(b=this.blog.getPost(a.id)){var c=this.blog.getPosts();miniLOL.content.set(this.blog.template.apply("post",{post:b,number:c.indexOf(b)+1,total:c.length}));if(miniLOL.config.Blog.title)document.title=miniLOL.config.Blog.title.interpolate(Object.extend(this.blog.getPostInfo(b),miniLOL.config.core))}else{miniLOL.error("Post not found.");
return false}else if(a.number){c=this.blog.getPosts();if(a.number<=c.length){b=c[parseInt(a.number)-1];miniLOL.content.set(this.blog.template.apply("post",{post:b,number:parseInt(a.number),total:c.length}));if(miniLOL.config.Blog.title)document.title=miniLOL.config.Blog.title.interpolate(Object.extend(this.blog.getPostInfo(b),miniLOL.config.core))}else{miniLOL.error("Post not found.");return false}}else{b=this.blog.getPosts();if(b.length==0){miniLOL.error("The blog is empty :(");return false}if(a.page>
Math.ceil(b.length/miniLOL.config.Blog.postsPerPage)||a.page<1){miniLOL.error("Page not found.");return false}c=[];for(var d=b.length-1-miniLOL.config.Blog.postsPerPage*(a.page-1),e=0;e<miniLOL.config.Blog.postsPerPage&&d>=0;d--,e++)c.push(b[d]);miniLOL.content.set(this.blog.template.apply("posts",{posts:c,page:parseInt(a.page),total:Math.ceil(this.blog.getPosts().length/miniLOL.config.Blog.postsPerPage)}))}}return true}});
